function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:34.0522342,lng:-118.2436849},zoom:11,styles:styles,draggable:!1,scrollwheel:!1}),createMapCenterMarker(),findMe()}function mapsLoadError(){window.alert("Google Maps could not be loaded.")}function findMe(){mapCenterMarker.setVisible(!1),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){currentPos={lat:a.coords.latitude,lng:a.coords.longitude},map.setCenter(currentPos),mapCenterMarker.setPosition(currentPos),mapCenterMarker.setVisible(!0),vm.distanceCalled(!1),resetMarkers()},function(){console.log("Geolocation ran but failed."),window.alert("Geolocation failed, so I sent you to LA. Search your location to see results near you!"),resetMarkers(),mapCenterMarker.setVisible(!0)}):(console.log("Geolocation is not supported in browser so it failed."),window.alert("Geolocation is disabled in your browser, so I sent you to LA. Search your location to see results near you!"),resetMarkers(),mapCenterMarker.setVisible(!0))}function createMapCenterMarker(){mapCenterMarker=new google.maps.Marker({position:{lat:map.center.lat(),lng:map.center.lng()},title:"You are here.",map:map,visible:!1,distance:0,animation:google.maps.Animation.DROP,icon:makeMarkerIcon("9fff82"),id:"Map Center"});var a='<div class="content"><p><span class="title">'+mapCenterMarker.title+"</span></p></div>",b=new google.maps.InfoWindow({content:a});mapCenterMarker.addListener("mouseover",function(){mapCenterMarker.setAnimation(google.maps.Animation.BOUNCE),b.open(map,mapCenterMarker)}),mapCenterMarker.addListener("mouseout",function(){setTimeout(function(){mapCenterMarker.setAnimation(google.maps.Animation.null)},750),b.close()})}function createFSQMarkerList(a){$.getJSON(a,function(a){foursquare=a.response.venues,0===foursquare.length&&window.alert("There's no coffee here! Try somewhere else.");var b=makeMarkerIcon("0091ff"),c=makeMarkerIcon("FFFF24"),d=new google.maps.InfoWindow;bounds=new google.maps.LatLngBounds;for(var e=0;e<foursquare.length;e++){var h,f=foursquare[e].location.lat,g=foursquare[e].location.lng;h=foursquare[e].venueChains.length>0,marker=new google.maps.Marker({position:{lat:f,lng:g},title:foursquare[e].name,map:map,isChain:h,distance:foursquare[e].location.distance,venueId:foursquare[e].id,animation:google.maps.Animation.DROP,icon:b,id:e}),google.maps.event.addDomListener(window,"resize",function(){map.fitBounds(bounds)}),google.maps.event.addListener(marker,"click",function(a,e){return function(){var e;e=a.isChain?'<span class="text-danger">This location is a chain.</span>':'<span class="text-success">Hipster Approved. #DrinkLocal</span>';var f='<div class="content"><p><span class="title">'+a.title+"</span><br />"+e+"<br />You are "+distanceConversion(a.distance)+' miles away.<br /> <a class="fsq-link" href="https://foursquare.com/v/'+a.venueId+'" target="_blank">See on Foursquare</a></p></div>';d.setContent(f),d.open(map,a),a.setIcon(c),a.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){a.setAnimation(null),a.setIcon(b)},1500)}}(marker)),vm.coffeeShops.push(marker),!0===vm.hipsterToggle()&&vm.hipsterify(),marker.addListener("mouseover",function(){this.setIcon(c)}),marker.addListener("mouseout",function(){this.setIcon(b)}),bounds.extend(vm.coffeeShops()[e].position),map.fitBounds(bounds)}}).fail(function(a,b,c){var d=b+", "+c;window.alert("Foursquare request failed, please check your location or credentials."),console.log("Request Failed: "+d)})}function makeMarkerIcon(a){return new google.maps.MarkerImage("https://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|"+a+"|40|_|%E2%80%A2",new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34),new google.maps.Size(21,34))}function distanceConversion(a){return Math.round(621371e-9*a*10)/10}function setMapOnAll(a){for(var b=0;b<vm.coffeeShops().length;b++)vm.coffeeShops()[b].setMap(a)}function clearMarkers(){setMapOnAll(null)}function deleteMarkers(){clearMarkers(),vm.coffeeShops.removeAll(),vm.hipsterShops.removeAll()}function setHipsterMarkers(){for(var a=0;a<vm.hipsterShops().length;a++)vm.hipsterShops()[a].setMap(map)}function setAllMarkers(){for(var a=0;a<vm.coffeeShops().length;a++)vm.coffeeShops()[a].setMap(map)}function resetMarkers(){deleteMarkers(),updateShops()}function changeMapCenter(){deleteMarkers();var a=new google.maps.Geocoder,b=vm.userDefLocation();a.geocode({address:b},function(a,b){b==google.maps.GeocoderStatus.OK?(newCenter=a[0].geometry.location,map.setCenter(newCenter),map.setZoom(12),mapCenterMarker.setPosition(newCenter)):window.alert("location could not be found, try another one!")}),google.maps.event.addListenerOnce(map,"idle",function(){updateShops()})}function updateShops(){url="https://api.foursquare.com/v2/venues/search?client_id="+client_id+"&client_secret="+client_secret+"&v=20170406&ll="+map.getCenter().lat().toString()+","+map.getCenter().lng().toString()+"&query=coffee&limit=25&radius=8000",createFSQMarkerList(url)}var vm={userDefLocation:ko.observable(""),coffeeShops:ko.observableArray([]),hipsterShops:ko.observableArray([]),tempArray:ko.observableArray([]),hipsterToggle:ko.observable(!1),distanceCalled:ko.observable(!1),sortHipsterArray(){this.hipsterShops(this.coffeeShops().slice()),this.hipsterShops.remove(function(a){return a.title.includes("The Coffee Bean")}),this.hipsterShops.remove(function(a){return a.title.includes("Coffee Bean")}),this.hipsterShops.remove(function(a){return a.title.includes("Starbuck")}),this.hipsterShops.remove(function(a){return a.title.includes("Peet")}),this.hipsterShops.remove(function(a){return a.isChain})},hipsterify(){this.hipsterToggle(!0),this.sortHipsterArray()},unhipsterify(){this.hipsterToggle(!1)},walkingDistance(){!1===this.distanceCalled()&&(this.tempArray(this.coffeeShops().slice()),this.coffeeShops.remove(function(a){return a.distance>1610}),this.sortHipsterArray()),this.distanceCalled(!0)},anyDistance(){!0===this.distanceCalled()&&(this.coffeeShops(this.tempArray().slice()),this.sortHipsterArray(),this.tempArray.removeAll(),this.distanceCalled(!1))}};ko.bindingHandlers.fadeVisible={init:function(a,b){var c=b();$(a).toggle(ko.unwrap(c))},update:function(a,b){var c=b();ko.unwrap(c)?$(a).slideDown(1e3):$(a).fadeOut(1e3)}},ko.applyBindings(vm);var map,currentPos,updatedLoc,userLoc,foursquare,url,marker,mapCenterMarker,bounds,client_id="IECW1ZSMEZ5QD15TXZWC5E1MPEXATEBUHIAEQPO005CZUEDK",client_secret="W1VA2ZRDWKZ3CXPNBEPH2C15XZB3104BF1OHHBWTJ4H5WNSO",styles=[{stylers:[{saturation:-100},{gamma:1}]},{elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"simplified"}]},{featureType:"water",stylers:[{visibility:"on"},{saturation:50},{gamma:0},{hue:"#50a5d1"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.fill",stylers:[{color:"#333333"}]},{featureType:"road.local",elementType:"labels.text",stylers:[{weight:.5},{color:"#333333"}]},{featureType:"transit.station",elementType:"labels.icon",stylers:[{gamma:1},{saturation:50}]}];vm.userDefLocation.subscribe(function(a){changeMapCenter()});
